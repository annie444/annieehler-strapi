---
/**
 * BlogSearch - Search input with System 8.0 styling
 * Integrates with Pagefind for static site search
 */
import Search from "@components/icons/pixel/Search.astro";

interface Props {
  placeholder?: string;
  class?: string;
}

const { placeholder = "Search posts...", class: className = "" } = Astro.props;
---

<div class:list={["blog-search relative", className]}>
  <input
    type="search"
    id="blog-search-input"
    placeholder={placeholder}
    class="font-chi border-foreground bg-grey-light placeholder:text-foreground-dim w-full border-2 border-solid px-3 py-2 pr-10 text-sm focus:ring-2 focus:ring-blue-400 focus:outline-none"
  />
  <Search
    class="text-foreground-dim absolute top-1/2 right-3 h-4 w-4 -translate-y-1/2"
    fill="none"
    stroke="currentColor"
  />
</div>

<script>
  // Simple client-side search for blog posts
  // Note: For production, integrate with Pagefind's API
  document.addEventListener("DOMContentLoaded", () => {
    const searchInput = document.getElementById(
      "blog-search-input",
    ) as HTMLInputElement;
    if (!searchInput) return;

    let debounceTimer: ReturnType<typeof setTimeout>;

    searchInput.addEventListener("input", (e) => {
      clearTimeout(debounceTimer);
      const query = (e.target as HTMLInputElement).value.trim().toLowerCase();

      debounceTimer = setTimeout(() => {
        // Dispatch custom event for parent to handle search
        const event = new CustomEvent("search-posts", {
          detail: { query },
          bubbles: true,
        });
        document.dispatchEvent(event);
      }, 300);
    });
  });
</script>
