---
/**
 * Project Card - Accordion window with project details
 */
import type { HTMLAttributes } from "astro/types";
import AccordionWindow from "@components/windows/AccordionWindow.astro";
import ProjectDetails from "@components/projects/ProjectDetails.astro";
import Blocks from "@components/react/Blocks";
import type { ProjectProps } from "@utils/content/project";

type Props = ProjectProps & Omit<HTMLAttributes<"details">, "class" | "open">;

const {
  title,
  description,
  tags,
  link,
  text,
  slug,
  problem,
  constraints,
  approach,
  result,
  codeUrl,
  liveUrl,
  screenshots,
  diagram,
  projectStatus,
  featured,
  ...rest
} = Astro.props as Props;

// Check if we have enhanced details
const hasEnhancedDetails =
  problem || constraints || approach || result || codeUrl || liveUrl;
---

<AccordionWindow title={title} open={true} {...rest} class="project-window">
  <div class="project-content p-4">
    <!-- Description -->
    <p class="mb-4 text-neutral-700 dark:text-neutral-300">
      {description}
    </p>

    <!-- Rich text content from Strapi -->
    {
      text && (
        <div class="mb-4">
          <Blocks content={text} client:load />
        </div>
      )
    }

    <!-- Enhanced project details -->
    {
      hasEnhancedDetails && (
        <ProjectDetails
          project={{
            title,
            description,
            tags,
            link,
            text,
            slug,
            problem,
            constraints,
            approach,
            result,
            codeUrl,
            liveUrl,
            screenshots,
            diagram,
            projectStatus,
            featured,
          }}
          class="mb-4"
        />
      )
    }

    <!-- Tags -->
    {
      tags && tags.length > 0 && (
        <div class="mb-4 flex flex-wrap gap-2">
          {tags.map((tag) => (
            <span class="border-2 border-solid border-neutral-900 bg-neutral-200 px-2 py-1 text-sm dark:border-neutral-300 dark:bg-neutral-800">
              {tag.name}
            </span>
          ))}
        </div>
      )
    }

    <!-- Legacy link (if no enhanced links) -->
    {
      link && !codeUrl && !liveUrl && (
        <a
          href={link}
          class="inline-block text-neutral-900 no-underline hover:underline dark:text-neutral-50"
        >
          Read more →
        </a>
      )
    }

    <!-- Featured badge -->
    {
      featured && (
        <div class="absolute -top-1 -right-1 flex h-6 w-6 items-center justify-center rounded-full bg-yellow-400 text-sm dark:bg-yellow-500">
          ★
        </div>
      )
    }
  </div>
</AccordionWindow>
