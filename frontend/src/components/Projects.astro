---
/**
 * Projects Grid - Displays project cards in a responsive grid
 *
 * Uses AccordionWindow for each project, leveraging native <details>
 * for expand/collapse behavior (no JavaScript needed).
 */
import type { ProjectProps } from "@utils/content/project";
import Project from "./Project.astro";

interface Props {
  projects: ProjectProps[];
}

const { projects } = Astro.props;
---

<section
  id="projects"
  class="masonry grid grid-cols-1 gap-8 p-8 md:grid-cols-[repeat(auto-fit,minmax(760px,1fr))]"
>
  {
    projects.map((project) => (
      <div class="project-item">
        <Project {...project} />
      </div>
    ))
  }
</section>

<script>
  import {
    resizeAllGridItems,
    resizeGridItem,
    setupMasonryGrid,
  } from "@utils/masonry";

  setupMasonryGrid("projects", "project-item", "project-content");

  function resizeOnToggle() {
    const projectWindows = document.getElementsByClassName(
      "project-window",
    ) as HTMLCollectionOf<HTMLDetailsElement>;
    for (const project of projectWindows) {
      project.addEventListener("toggle", (e: ToggleEvent) => {
        const target = e.target as HTMLDetailsElement;
        const item = target.closest(".project-item") as HTMLElement;
        if (target.open) {
          resizeGridItem(item);
        } else {
          item.style.gridRowEnd = "span 1";
        }
      });
    }
  }

  window.addEventListener("resize", resizeAllGridItems);
  window.addEventListener("DOMContentLoaded", () => {
    resizeAllGridItems();
    resizeOnToggle();
  });
</script>

<style is:global>
  .masonry {
    grid-auto-rows: 28px;
  }
</style>
