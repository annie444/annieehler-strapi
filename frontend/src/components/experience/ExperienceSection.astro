---
/**
 * ExperienceSection - Finder-style window with job history list
 *
 * Single window containing all jobs as expandable rows.
 * Mimics System 8.0 Finder list view.
 */
import AccordionWindow from "@components/windows/AccordionWindow.astro";
import ExperienceRow from "./ExperienceRow.astro";
import type { ExperienceProps } from "@utils/content/experience";

interface Props {
  experience: ExperienceProps[];
  class?: string;
}

const { experience, class: className = "" } = Astro.props;

// Sort by start date descending (most recent first)
const sortedExperience = [...experience].sort((a, b) => {
  return new Date(b.startDate).getTime() - new Date(a.startDate).getTime();
});

const itemCount = experience.length;
---

<section class:list={["w-full px-4 py-8 md:px-8", className]}>
  <h2 class="font-chi mb-6 text-2xl font-bold">Experience</h2>

  <AccordionWindow title="Work History" open={true} class="experience-window">
    <!-- Column headers -->
    <div
      class="grid grid-cols-[26px_2fr_3fr_2fr] items-center border-b border-solid border-neutral-300 bg-neutral-200 px-3 py-1.5 md:grid-cols-[26px_2fr_4fr_2fr] lg:grid-cols-[26px_2fr_7fr_2fr] xl:grid-cols-[26px_2fr_11fr_2fr] 2xl:grid-cols-[26px_2fr_14fr_2fr] dark:border-neutral-600 dark:bg-neutral-800"
    >
      <span class="w-5"></span>
      <span
        class="font-chi ml-1 text-sm font-semibold tracking-wide text-neutral-600 uppercase dark:text-neutral-400"
      >
        Company
      </span>
      <span
        class="font-chi ml-1 text-sm font-semibold tracking-wide text-neutral-600 uppercase dark:text-neutral-400"
      >
        Role
      </span>
      <span
        class="font-chi mr-1 text-right text-sm font-semibold tracking-wide text-neutral-600 uppercase dark:text-neutral-400"
      >
        Dates
      </span>
    </div>

    <!-- Job rows -->
    <div>
      {
        sortedExperience.map((exp, index) => (
          <ExperienceRow
            experience={exp}
            expanded={index === 0}
            isEven={index % 2 === 0}
          />
        ))
      }

      {
        experience.length === 0 && (
          <div class="p-8 text-center">
            <p class="font-chi text-neutral-500 dark:text-neutral-400">
              No experience items to display
            </p>
          </div>
        )
      }
    </div>

    <!-- Footer with item count -->
    <div
      class="flex items-center justify-between border-t border-solid border-neutral-300 bg-neutral-100 px-3 py-1.5 dark:border-neutral-600 dark:bg-neutral-800"
    >
      <span class="font-chi text-xs text-neutral-500 dark:text-neutral-400">
        {itemCount}
        {itemCount === 1 ? "item" : "items"}
      </span>
      <span class="font-chi text-xs text-neutral-500 dark:text-neutral-400">
        ~/experience
      </span>
    </div>
  </AccordionWindow>

  <p class="mt-3 text-center text-sm text-neutral-500 dark:text-neutral-400">
    Click on a row to expand details
  </p>
</section>
