---
/**
 * ExperienceSection - Finder-style window with job history list
 *
 * Single window containing all jobs as expandable rows.
 * Mimics System 8.0 Finder list view.
 */
import AccordionWindow from "@components/windows/AccordionWindow.astro";
import ExperienceRow from "@components/experience/ExperienceRow.astro";
import Heading from "@components/ui/Heading.astro";
import Section from "@components/ui/Section.astro";
import type { ExperienceProps } from "@utils/content/experience";

interface Props {
  experience: ExperienceProps[];
  class?: string;
}

const { experience, class: className = "" } = Astro.props;

// Sort by start date descending (most recent first)
const sortedExperience = [...experience].sort((a, b) => {
  return new Date(b.startDate).getTime() - new Date(a.startDate).getTime();
});

const experienceIds = sortedExperience.map((exp) => `experience-${exp.slug}`);

const itemCount = experience.length;
---

<Section
  id="work-experience"
  class:list={[className]}
  data-experiences={experienceIds.join(",")}
>
  <Heading>Experience</Heading>

  <AccordionWindow title="Work History" open={true} class="experience-window">
    <!-- Column headers -->
    <div
      class:list={[
        "grid items-center gap-3 px-3 py-1.5",
        "border-grey-dark bg-grey-medium border-b border-solid",
        "grid-cols-[26px_2fr_3fr_2fr]",
        "md:grid-cols-[26px_2fr_4fr_2fr]",
        "lg:grid-cols-[26px_2fr_7fr_2fr]",
        "xl:grid-cols-[26px_2fr_11fr_2fr]",
        "2xl:grid-cols-[26px_2fr_14fr_2fr]",
      ]}
    >
      <span class="w-5"></span>
      <span
        class="font-chi text-foreground-dim text-sm font-semibold tracking-wide uppercase"
      >
        Company
      </span>
      <span
        class="font-chi text-foreground-dim ml-1 text-sm font-semibold tracking-wide uppercase"
      >
        Role
      </span>
      <span
        class="font-chi text-foreground-dim mr-1 text-right text-sm font-semibold tracking-wide uppercase"
      >
        Dates
      </span>
    </div>

    <!-- Job rows -->
    <div>
      {
        sortedExperience.map((exp, index) => (
          <ExperienceRow
            experience={exp}
            expanded={index === 0}
            isEven={index % 2 === 0}
          />
        ))
      }

      {
        experience.length === 0 && (
          <div class="p-8 text-center">
            <p class="font-chi text-foreground-dim">
              No experience items to display
            </p>
          </div>
        )
      }
    </div>

    <!-- Footer with item count -->
    <div
      class="border-grey-dark bg-grey-medium flex items-center justify-between border-t border-solid px-3 py-1.5"
    >
      <span class="font-chi text-foreground-dim text-xs">
        {itemCount}
        {itemCount === 1 ? "item" : "items"}
      </span>
      <span class="font-chi text-foreground-dim text-xs"> ~/experience </span>
    </div>
  </AccordionWindow>

  <p class="text-foreground-dim mt-3 text-center text-sm">
    Click on a row to expand details
  </p>
</Section>

<script>
  import { attachExperienceFolderAnimations } from "@utils/folder";
  window.addEventListener("DOMContentLoaded", () => {
    attachExperienceFolderAnimations();
  });
</script>
