---
/**
 * ExperienceRow - Single job row in Finder list view
 *
 * Displays as a row with folder icon, company, role, dates.
 * Expands on click to show description and details.
 */
import AnimatedFolder from "@components/icons/pixel/AnimatedFolder.astro";
import type { ExperienceProps } from "@utils/content/experience";
import { formatDateRange, calculateDuration } from "@utils/content/experience";

interface Props {
  experience: ExperienceProps;
  isEven?: boolean;
  expanded?: boolean;
}

const { experience, expanded = false, isEven = false } = Astro.props;

const dateRange = formatDateRange(experience.startDate, experience.endDate);
const duration = calculateDuration(experience.startDate, experience.endDate);
const isCurrentJob = !experience.endDate;

const detailsId = `experience-${experience.slug}`;
---

<details
  open={expanded}
  id={detailsId}
  class:list={["group", isEven ? "bg-grey-medium" : "bg-grey-light"]}
>
  <!-- Row summary (always visible) -->
  <summary
    class="border-grey-dark grid cursor-pointer list-none grid-cols-[26px_2fr_3fr_2fr] items-center border-b border-solid px-3 py-2 transition-colors hover:bg-blue-100 md:grid-cols-[26px_2fr_4fr_2fr] lg:grid-cols-[26px_2fr_7fr_2fr] xl:grid-cols-[26px_2fr_11fr_2fr] 2xl:grid-cols-[26px_2fr_14fr_2fr]"
  >
    <!-- Folder icon -->
    <AnimatedFolder size={20} open={expanded} class="fill-foreground" />

    <!-- Company -->
    <span class="font-chi font-bold">
      {experience.company}
      {
        isCurrentJob && (
          <span class="ml-1 inline-block rounded bg-green-200 px-1 py-0.5 text-sm font-medium text-green-800 dark:bg-green-800 dark:text-green-200">
            Current
          </span>
        )
      }
    </span>

    <!-- Role -->
    <span class="text-foreground text-wrap">
      {experience.role}
    </span>

    <!-- Dates -->
    <span class="font-chi text-foreground-dim text-right text-sm">
      {dateRange}
    </span>
  </summary>

  <!-- Expanded details -->
  <div
    class="experience-details border-grey-medium bg-grey-light border-b border-solid px-4 py-3 pl-10"
  >
    <!-- Location -->
    {
      experience.location ? (
        experience.link ? (
          <div class="mb-2 flex flex-row items-center justify-between">
            <p class="text-foreground-dim text-sm">
              {experience.location} &centerdot; {duration}
            </p>
            <a
              href={experience.link}
              target="_blank"
              rel="noopener noreferrer"
              class="font-chi text-foreground-dim mr-4 underline hover:text-blue-600 md:mr-6 dark:hover:text-blue-400"
            >
              Visit Site
            </a>
          </div>
        ) : (
          <p class="text-foreground-dim mb-2 text-sm">
            {experience.location} &centerdot; {duration}
          </p>
        )
      ) : experience.link ? (
        <div class="mb-2 flex flex-row items-center justify-between">
          <p class="text-foreground-dim text-sm">{duration}</p>
          <a
            href={experience.link}
            target="_blank"
            rel="noopener noreferrer"
            class="font-chi text-foreground-dim mr-4 underline hover:text-blue-600 md:mr-6 dark:hover:text-blue-400"
          >
            Visit Site
          </a>
        </div>
      ) : (
        <p class="text-foreground-dim mb-2 text-sm">{duration}</p>
      )
    }

    <!-- Description -->
    <p class="text-foreground mb-3">
      {experience.description}
    </p>

    <!-- Highlights -->
    {
      experience.highlights && experience.highlights.length > 0 && (
        <ul class="text-foreground mb-3 list-inside list-disc space-y-1">
          {experience.highlights.map((highlight) => (
            <li>{highlight}</li>
          ))}
        </ul>
      )
    }

    <!-- Technologies -->
    {
      experience.technologies && experience.technologies.length > 0 && (
        <div class="flex flex-wrap gap-1">
          {experience.technologies.map((tech) => (
            <span class="border-grey-dark bg-grey-medium inline-block border border-solid px-1.5 py-0.5 text-sm">
              {tech.name}
            </span>
          ))}
        </div>
      )
    }
  </div>
</details>

<style>
  /* Hide default details marker */
  summary::-webkit-details-marker,
  summary::marker {
    display: none;
  }

  /* Smooth expand animation */
  .experience-details {
    animation: slideDown 0.15s ease-out;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      max-height: 0;
    }
    to {
      opacity: 1;
      max-height: 500px;
    }
  }
</style>
