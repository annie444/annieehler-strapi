---
/**
 * Projects Grid - Displays project cards in a responsive grid
 *
 * Uses AccordionWindow for each project, leveraging native <details>
 * for expand/collapse behavior (no JavaScript needed).
 */
import type { ProjectProps } from "@utils/content/project";
import Heading from "@components/ui/Heading.astro";
import Project from "@components/projects/Project.astro";
import Section from "@components/ui/Section.astro";

interface Props {
  projects: ProjectProps[];
}

const { projects } = Astro.props;
---

<Section id="projects">
  <Heading>Projects</Heading>

  <div
    id="project-grid"
    class="masonry grid grid-cols-1 gap-8 md:grid-cols-[repeat(auto-fit,minmax(760px,1fr))]"
  >
    {
      projects.map((project) => (
        <div class="project-item">
          <Project {...project} />
        </div>
      ))
    }
  </div>
</Section>

<script>
  import {
    resizeAllGridItems,
    resizeGridItem,
    setupMasonryGrid,
  } from "@utils/masonry";

  setupMasonryGrid("project-grid", "project-item", "project-content");

  function resizeOnToggle() {
    const projectWindows = document.getElementsByClassName(
      "project-window",
    ) as HTMLCollectionOf<HTMLDetailsElement>;
    for (const project of projectWindows) {
      project.addEventListener("toggle", (e: ToggleEvent) => {
        const target = e.target as HTMLDetailsElement;
        const item = target.closest(".project-item") as HTMLElement;
        if (target.open) {
          resizeGridItem(item);
        } else {
          item.style.gridRowEnd = "span 1";
        }
      });
    }
  }

  window.addEventListener("resize", resizeAllGridItems);

  window.addEventListener("DOMContentLoaded", () => {
    resizeAllGridItems();
    resizeOnToggle();
  });

  window.addEventListener("load", () => {
    resizeAllGridItems();
    resizeOnToggle();
  });
</script>

<style is:global>
  .masonry {
    grid-auto-rows: 28px;
  }
</style>
