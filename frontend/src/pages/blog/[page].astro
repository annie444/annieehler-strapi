---
import Layout from "../../layouts/Layout.astro";
import { posts, siteMeta } from "../../content/siteData";
import type { GetStaticPaths } from "astro";

const pageSize = 3;
const sorted = [...posts].sort((a, b) => b.pubDate.localeCompare(a.pubDate));

export const getStaticPaths = (async ({ paginate }) => {
  const pageSize = 3;
  const sorted = [...posts].sort((a, b) => b.pubDate.localeCompare(a.pubDate));
  return paginate(sorted, { pageSize });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
const { data, currentPage, lastPage } = page;
const total = sorted.length;
const start = (currentPage - 1) * pageSize + 1;
const end = Math.min(currentPage * pageSize, total);
---

<Layout>
  <section class="card">
    <div class="overlay"></div>
    <div class="relative z-10 space-y-4">
      <div class="flex items-center justify-between gap-3">
        <h2 class="text-xl font-semibold tracking-wide">Blog & Notes</h2>
        <span class="pill">{siteMeta.name}</span>
      </div>
      <p class="text-sm leading-relaxed text-[#a5b4d6]">
        Streaming architecture thoughts, DX rants, and colorful experiments.
        Backed by static data now, ready for CMS wiring later.
      </p>
      <div class="grid gap-4">
        {
          data.map((post) => (
            <article class="card p-5">
              <div class="overlay" />
              <div class="relative z-10 space-y-3">
                <div class="flex items-center justify-between gap-3">
                  <h3 class="text-lg font-semibold">{post.title}</h3>
                  <span class="pill">{post.pubDate}</span>
                </div>
                <p class="text-sm leading-relaxed text-[#a5b4d6]">
                  {post.description}
                </p>
                <a class="btn" href={`/blog/${post.slug}`}>
                  Read draft
                </a>
              </div>
            </article>
          ))
        }
      </div>
      <div class="flex flex-wrap items-center gap-3">
        <span class="pill">Showing {start}–{end} of {total}</span>
        <span class="pill">Page {currentPage} / {lastPage}</span>
        {
          currentPage > 1 && (
            <a class="pill" href={`/blog/${currentPage - 1}`}>
              ← Prev
            </a>
          )
        }
        {
          currentPage < lastPage && (
            <a class="pill" href={`/blog/${currentPage + 1}`}>
              Next →
            </a>
          )
        }
      </div>
    </div>
  </section>
</Layout>
